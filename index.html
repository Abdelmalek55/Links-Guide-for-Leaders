<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù„Ù„Ù‚Ø§Ø¯Ø©</title>
<style>
  :root{
    --bg-1:#071127;
    --bg-2:#0b1522;
    --card:#0e1926;
    --muted:#9aa4b2;
    --accent:#3b82f6;
    --accent-2:#6ee7b7;
    --glass: rgba(255,255,255,0.03);
    --radius:14px;
    --btn-size:140px;
    --gap:18px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: Inter, "Tajawal", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: radial-gradient(800px 400px at 10% 10%, rgba(59,130,246,0.06), transparent),
                radial-gradient(600px 300px at 90% 90%, rgba(99,102,241,0.03), transparent),
                linear-gradient(180deg,var(--bg-1),var(--bg-2));
    color:#e6eef6;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:30px;
    display:flex;
    justify-content:center;
    min-height:100vh;
  }
  .wrap{width:100%;max-width:1100px;}

  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;gap:12px}
  header .title{display:flex;flex-direction:column}
  h1{margin:0;font-size:22px;letter-spacing:0.2px;color:var(--accent);}
  .user-title{
    font-size: 22px;
    font-weight: bold;
    color: var(--accent-2);
    margin-bottom: 2px;
    margin-top: 10px;
    letter-spacing: 0.5px;
    text-shadow: 0 2px 10px #3b82f680;
  }
  p.lead{margin:4px 0 0;color:var(--muted);font-size:14px}

  .controls{display:flex;gap:10px;align-items:center}
  .btn{background:var(--glass);border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:12px;cursor:pointer;color:inherit;font-weight:600;transition:.15s;}
  .btn.strong{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#04233b;box-shadow:0 8px 24px rgba(59,130,246,0.14)}
  .btn:hover,.a-btn:hover{filter:brightness(1.08);background:var(--glass);}

  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.006));border-radius:20px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
  .footer-note{display:flex;justify-content:space-between;color:var(--muted);font-size:13px;margin-top:12px}

  .grid{
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(var(--btn-size), 1fr));
    gap:var(--gap);
    justify-items:end;
    align-items:start;
    padding:6px;
  }

  .tile{
    width:100%;
    max-width:320px;
    background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.006));
    border-radius:14px;
    padding:14px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
    border:1px solid rgba(255,255,255,0.03);
    transition:transform .18s ease, box-shadow .18s ease;
  }
  .tile:hover{transform:translateY(-6px);box-shadow:0 12px 36px rgba(2,6,23,0.6)}

  .face{
    width:var(--btn-size);
    height:var(--btn-size);
    border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:40px;
    background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.03);
    overflow:hidden;
    position:relative;
    transition:box-shadow .18s, transform .18s;
  }
  .face img{width:100%;height:100%;object-fit:cover}
  .face:hover{transform:scale(1.04);box-shadow:0 10px 30px rgba(59,130,246,0.08)}

  .label{width:100%;text-align:right}
  .label h3{
    margin:0;
    font-size:15px;
    white-space: normal;
    overflow-wrap: break-word;
    text-overflow: unset;
    word-break: break-all;
    line-height:1.6;
    color:#e6eef6;
  }
  .label p{margin:4px 0 0;color:var(--muted);font-size:13px;overflow:hidden;text-overflow:ellipsis}

  .actions{
    width:100%;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    justify-items: center;
    align-items: center;
    margin-top: 4px;
  }
  .a-btn{
    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
    border:1px solid rgba(255,255,255,0.03);
    padding:8px 10px;
    border-radius:10px;
    color:var(--muted);
    font-weight:700;
    cursor:pointer;
    transition: transform .14s, box-shadow .14s;
    width:100%;
    font-size:14px;
  }
  .a-btn:hover{transform:translateY(-4px);box-shadow:0 8px 22px rgba(2,6,23,0.45);color:#eaf6ff}

  .main-cta{
    width:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:8px;
    border-radius:12px;
  }
  .cta-btn{
    width:100%;
    padding:18px;
    border-radius:12px;
    border:none;
    background:linear-gradient(90deg,var(--accent),var(--accent-2));
    color:#04233b;
    font-weight:800;
    font-size:16px;
    cursor:pointer;
    box-shadow:0 8px 30px rgba(59,130,246,0.16);
    transition:transform .16s ease, box-shadow .16s ease;
  }
  .cta-btn:hover{transform:translateY(-6px) scale(1.02);box-shadow:0 18px 48px rgba(59,130,246,0.22)}

  .modal-back{
    position:fixed;inset:0;background:rgba(2,6,23,0.55);display:none;align-items:center;justify-content:center;z-index:60;
    -webkit-backdrop-filter: blur(6px);
    backdrop-filter: blur(6px);
    padding:20px;
  }
  .modal{
    width:100%;max-width:720px;background:linear-gradient(180deg, rgba(6,12,22,0.9), rgba(8,16,28,0.9));
    border-radius:14px;padding:18px;border:1px solid rgba(255,255,255,0.04);color:inherit;
    box-shadow:0 18px 60px rgba(2,6,23,0.7);
    animation:modalIn .22s ease;
  }
  @keyframes modalIn{from{opacity:0;transform:translateY(-8px)} to{opacity:1;transform:none}}

  .form-row{display:flex;gap:10px;margin-bottom:10px;align-items:center}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  input[type="text"], select{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}

  .icon-picker{
    width:420px;max-width:94vw;background:rgba(7,17,39,0.85);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.06);
    max-height:78vh;overflow:auto;
  }
  .icon-grid{
    display:grid;grid-template-columns:repeat(auto-fill,minmax(56px,1fr));gap:10px;margin-top:8px;
  }
  .icon-tile{font-size:26px;padding:10px;border-radius:8px;text-align:center;cursor:pointer;transition:background .12s,transform .12s}
  .icon-tile:hover{background:rgba(255,255,255,0.04);transform:scale(1.08)}

  .login-mode-btns{
    display:flex;
    gap:12px;
    margin-bottom:15px;
    justify-content: center;
  }
  .login-mode-btn{
    background:linear-gradient(90deg,var(--accent),var(--accent-2));
    color:#04233b;
    font-weight:700;
    border:none;
    border-radius:10px;
    padding:8px 22px;
    font-size:16px;
    cursor:pointer;
    transition:0.15s;
    box-shadow:0 2px 18px rgba(59,130,246,0.13)
  }
  .login-mode-btn.selected{
    background:#fff;
    color:var(--accent);
    border:2px solid var(--accent-2);
    box-shadow:0 4px 22px rgba(59,130,246,0.18)
  }
  @media (max-width:720px){
    .grid{grid-template-columns:repeat(auto-fill,minmax(140px,1fr));justify-items:center}
    .actions{gap:6px}
    .cta-btn{padding:14px}
    .user-title{font-size: 18px;}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù„Ù„Ù‚Ø§Ø¯Ø©</h1>
        <div class="user-title" id="userTitle" style="display:none"></div>
        <p class="lead">Ø¯Ù„ÙŠÙ„Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„Ø£Ù‡Ù… Ø§Ù„Ø±ÙˆØ§Ø¨Ø· â€” ØµÙ…Ù… Ù‚Ø§Ø¦Ù…ØªÙƒ ÙˆØ´Ø§Ø±ÙƒÙ‡Ø§ Ø¨Ø³Ù‡ÙˆÙ„Ø©</p>
      </div>
      <div class="controls" role="toolbar">
        <button class="btn" id="changeUserBtn">ğŸ‘¤ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        <button class="btn" id="importBtn">ğŸ“‚ Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON</button>
        <button class="btn" id="exportBtn">ğŸ’¾ ØªØµØ¯ÙŠØ± JSON</button>
        <button class="btn strong" id="addBtn">+ Ø¥Ø¶Ø§ÙØ© Ø²Ø±</button>
      </div>
    </header>

    <section class="card">
      <div id="grid" class="grid" aria-live="polite"></div>
      <div class="footer-note">
        <div>Ø§Ø³Ø­Ø¨ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨ Â· Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù„ÙØªØ­Ù‡</div>
        <div class="muted">ÙŠÙØ­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ (Ø§Ù„Ø§Ø³Ù… + Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ)</div>
      </div>
    </section>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„/Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ -->
  <div class="modal-back" id="userModal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="userTitleModal">
      <h2 id="userTitleModal">Ø§Ø®ØªØ± ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <div class="login-mode-btns" id="loginModeBtns">
        <button class="login-mode-btn selected" id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        <button class="login-mode-btn" id="createBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
      </div>
      <div id="userFormWrap">
        <div class="form-row" style="flex-direction:column">
          <label for="userInput">Ø§Ø³Ù…Ùƒ</label>
          <input id="userInput" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù‚Ø§Ø¦Ø¯ Ù…Ø­Ù…Ø¯" autocomplete="off">
        </div>
        <div class="form-row" style="flex-direction:column">
          <label for="phoneInput">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
          <input id="phoneInput" type="text" placeholder="Ù…Ø«Ø§Ù„: 201234567890" autocomplete="off" inputmode="tel">
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
          <button class="btn" id="cancelUserModal" style="display:none">Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn strong" id="saveUserModal">Ù…ØªØ§Ø¨Ø¹Ø©</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„Ø§Øª ÙƒÙ…Ø§ Ù‡ÙŠ ... -->
  <div class="modal-back" id="formModal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="formTitle">
      <h2 id="formTitle">Ø£Ø¶Ù / Ø¹Ø¯Ù‘Ù„ Ø²Ø±</h2>
      <div style="margin-top:10px">
        <div class="form-row" style="flex-direction:column">
          <label for="labelInput">Ø§Ù„Ø§Ø³Ù… (ÙŠØ¸Ù‡Ø±)</label>
          <input id="labelInput" type="text" placeholder="Ù…Ø«Ø§Ù„: YouTube">
        </div>
        <div class="form-row" style="flex-direction:column">
          <label for="urlInput">Ø§Ù„Ø±Ø§Ø¨Ø· (URL)</label>
          <input id="urlInput" type="text" placeholder="https://...">
        </div>
        <div class="form-row">
          <div style="flex:1">
            <label for="faceType">Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¬Ù‡</label>
            <select id="faceType">
              <option value="icon">Ø£ÙŠÙ‚ÙˆÙ†Ø©</option>
              <option value="image">ØµÙˆØ±Ø© (Ø±Ø§Ø¨Ø·)</option>
            </select>
          </div>
          <div style="width:150px">
            <label>&nbsp;</label>
            <button class="btn" id="openIconPickerBtn" style="width:100%;">Ø§Ø®ØªÙŠØ§Ø± Ø±Ù…Ø²</button>
          </div>
        </div>
        <div class="form-row" style="flex-direction:column">
          <label id="imgLabel" style="display:none">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
          <input id="iconInput" type="text" placeholder="ğŸ”— Ø£Ùˆ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø©">
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
          <button class="btn" id="cancelModal">Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn strong" id="saveModal">Ø­ÙØ¸</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-back" id="iconPickerBack" style="z-index:80">
    <div class="icon-picker" role="dialog" aria-modal="true" aria-labelledby="iconTitle">
      <h3 id="iconTitle">Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠÙ‚ÙˆÙ†Ø©</h3>
      <div class="icon-grid" id="iconGrid"></div>
      <div style="display:flex;justify-content:flex-end;margin-top:10px">
        <button class="btn" id="closeIconPicker">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>
  <div class="modal-back" id="shareModal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="shareTitle">
      <h3 id="shareTitle">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ø§Ø¨Ø·</h3>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
        <button class="btn" id="copyLinkBtn">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
        <button class="btn" id="whatsBtn">ğŸ’¬ Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
        <button class="btn" id="closeShare">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>
  <div class="modal-back" id="whatsModal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="whatsTitle">
      <h3 id="whatsTitle">Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</h3>
      <div style="display:flex;flex-direction:column;gap:10px;margin-top:8px">
        <button class="btn" id="waNoNumber">Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù… (ÙŠÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨)</button>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="waNumber" type="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… Ø¨Ø¯ÙˆÙ† (+ Ø£Ùˆ 0) - Ù…Ø«Ø§Ù„: 201234567890" style="flex:1" />
          <button class="btn strong" id="waWithNumber">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
        <div style="display:flex;justify-content:flex-end"><button class="btn" id="closeWhats">Ø¥ØºÙ„Ø§Ù‚</button></div>
      </div>
    </div>
  </div>
  <input id="fileInput" type="file" accept="application/json" style="display:none" />
<script>
/* ----------- Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… + Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙˆÙˆØ§Ø¬Ù‡Ø© ØªØ³Ø¬ÙŠÙ„/Ø¯Ø®ÙˆÙ„ ----------- */
let currentUser = null;
let currentPhone = null;
const userTitle = document.getElementById('userTitle');
const userModal = document.getElementById('userModal');
const userInput = document.getElementById('userInput');
const phoneInput = document.getElementById('phoneInput');
const saveUserModalBtn = document.getElementById('saveUserModal');
const cancelUserModalBtn = document.getElementById('cancelUserModal');
const changeUserBtn = document.getElementById('changeUserBtn');
const loginBtn = document.getElementById('loginBtn');
const createBtn = document.getElementById('createBtn');
const loginModeBtns = document.getElementById('loginModeBtns');
const userFormWrap = document.getElementById('userFormWrap');

let loginMode = "login"; // "login" or "create"

function getUserStorageKey(name, phone){
  return 'LINK_GUIDE_USERDATA_V2_' + btoa(encodeURIComponent(name.trim()+"::"+phone.trim()));
}
function getUsersList(){
  try {
    return JSON.parse(localStorage.getItem("LINK_GUIDE_USERS_LIST_V2") || "[]");
  } catch { return []; }
}
function saveUsersList(usersArr){
  localStorage.setItem("LINK_GUIDE_USERS_LIST_V2", JSON.stringify(usersArr));
}
function saveUserData(name, phone){
  localStorage.setItem("LINK_GUIDE_USER_V2", JSON.stringify({ name, phone }));
}

function getSavedUser() {
  try {
    const userRaw = localStorage.getItem("LINK_GUIDE_USER_V2");
    if (!userRaw) return null;
    const obj = JSON.parse(userRaw);
    if (obj && obj.name && obj.phone) return obj;
    return null;
  } catch { return null; }
}

function showUserModal(firstTime){
  userModal.style.display = 'flex';
  if(firstTime) cancelUserModalBtn.style.display = 'none';
  else cancelUserModalBtn.style.display = 'inline-block';
  userInput.value = currentUser || '';
  phoneInput.value = currentPhone || '';
  setTimeout(()=>userInput.focus(), 100);
  // reset login mode
  setLoginMode("login");
}
function setLoginMode(mode){
  loginMode = mode;
  if(mode === "login"){
    loginBtn.classList.add("selected");
    createBtn.classList.remove("selected");
    userInput.value = "";
    phoneInput.value = "";
    userInput.placeholder = "Ù…Ø«Ø§Ù„: Ø§Ù„Ù‚Ø§Ø¦Ø¯ Ù…Ø­Ù…Ø¯";
    phoneInput.placeholder = "Ù…Ø«Ø§Ù„: 201234567890";
  }else{
    createBtn.classList.add("selected");
    loginBtn.classList.remove("selected");
    userInput.value = "";
    phoneInput.value = "";
    userInput.placeholder = "Ø§Ø®ØªØ± Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯";
    phoneInput.placeholder = "Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ø§Ù„: 201234567890)";
  }
}
loginBtn.onclick = ()=>setLoginMode("login");
createBtn.onclick = ()=>setLoginMode("create");

function saveUserName(){
  const name = userInput.value.trim();
  const phone = phoneInput.value.trim();
  if(!name){ alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù…Ùƒ."); userInput.focus(); return; }
  if(!phone || !/^\d{7,}$/.test(phone)){ alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­."); phoneInput.focus(); return; }
  // Ø³Ø¬Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ù…ØµÙÙˆÙØ© Ù…Ù†ÙØµÙ„Ø©
  let usersArr = getUsersList();
  const storageKey = getUserStorageKey(name, phone);

  if(loginMode==="login"){
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    if(!usersArr.find(u=>u.name===name && u.phone===phone)){
      alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ. ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯.");
      return;
    }
    const userData = localStorage.getItem(storageKey);
    if(!userData){
      alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨.");
      return;
    }
    currentUser = name;
    currentPhone = phone;
    saveUserData(currentUser, currentPhone);
    userTitle.textContent = "ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: " + currentUser + " | ğŸ“± " + currentPhone;
    userTitle.style.display = 'block';
    userModal.style.display = 'none';
    loadUserState();
  }else{ // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
    if(usersArr.find(u=>u.name===name && u.phone===phone)){
      alert("Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.");
      return;
    }
    usersArr.push({ name, phone });
    saveUsersList(usersArr);
    // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª ÙØ§Ø±ØºØ©
    localStorage.setItem(storageKey, JSON.stringify(getDefaultLinks()));
    currentUser = name;
    currentPhone = phone;
    saveUserData(currentUser, currentPhone);
    userTitle.textContent = "ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: " + currentUser + " | ğŸ“± " + currentPhone;
    userTitle.style.display = 'block';
    userModal.style.display = 'none';
    loadUserState();
  }
}
function checkUser(){
  const userObj = getSavedUser();
  if(!userObj){
    showUserModal(true);
  }else{
    currentUser = userObj.name;
    currentPhone = userObj.phone;
    userTitle.textContent = "ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: " + currentUser + " | ğŸ“± " + currentPhone;
    userTitle.style.display = 'block';
  }
}
saveUserModalBtn.onclick = saveUserName;
cancelUserModalBtn.onclick = ()=>{ userModal.style.display='none'; };
changeUserBtn.onclick = ()=> showUserModal(false);
userInput.addEventListener('keydown',e=>{ if(e.key==='Enter') saveUserName(); });
phoneInput.addEventListener('keydown',e=>{ if(e.key==='Enter') saveUserName(); });

checkUser();

/* ------------- Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…+Ù‡Ø§ØªÙ) ------------- */
const grid = document.getElementById('grid');
function STORAGE_KEY(){
  return getUserStorageKey(currentUser||'', currentPhone||'');
}
let state = loadState();
let editingKey = null;

function loadUserState(){
  state = loadState();
  render();
}

function saveState(){ localStorage.setItem(STORAGE_KEY(), JSON.stringify(state)); }
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY());
    return raw ? JSON.parse(raw) : getDefaultLinks();
  }catch(e){
    return getDefaultLinks();
  }
}
function getDefaultLinks(){
  return [
    { key:'youtube', label:'YouTube', url:'https://youtube.com', faceType:'icon', icon:'â–¶ï¸' },
    { key:'whatsapp', label:'WhatsApp', url:'https://wa.me', faceType:'icon', icon:'ğŸ’¬' },
    { key:'facebook', label:'Facebook', url:'https://facebook.com', faceType:'icon', icon:'ğŸ“˜' }
  ];
}

function render(){
  grid.innerHTML = '';
  state.forEach(item=>{
    const tile = document.createElement('div');
    tile.className = 'tile';
    tile.dataset.key = item.key;
    tile.draggable = true;

    // face (icon or image)
    const face = document.createElement('div');
    face.className = 'face';
    if(item.faceType === 'image' && item.icon){
      const img = document.createElement('img');
      img.src = item.icon;
      img.alt = item.label;
      face.appendChild(img);
    } else {
      if(item.icon && item.icon.trim().startsWith('<svg')){
        face.innerHTML = item.icon;
      } else {
        const span = document.createElement('div');
        span.textContent = item.icon || 'ğŸ”˜';
        span.style.fontSize = '36px';
        face.appendChild(span);
      }
    }

    // label
    const labelWrap = document.createElement('div');
    labelWrap.className = 'label';
    const h3 = document.createElement('h3'); h3.textContent = item.label || 'No name';
    const p = document.createElement('p'); p.textContent = item.url || '';
    labelWrap.appendChild(h3); labelWrap.appendChild(p);

    // actions under face
    const actions = document.createElement('div');
    actions.className = 'actions';

    const editBtn = document.createElement('button'); editBtn.className='a-btn'; editBtn.textContent='âœï¸ ØªØ¹Ø¯ÙŠÙ„';
    editBtn.addEventListener('click', (e)=>{ e.stopPropagation(); openFormModal(item.key); });

    const delBtn = document.createElement('button'); delBtn.className='a-btn'; delBtn.textContent='ğŸ—‘ï¸ Ø­Ø°Ù';
    delBtn.addEventListener('click', (e)=>{ e.stopPropagation(); if(confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø²Ø±ØŸ')){ state = state.filter(s=>s.key!==item.key); saveState(); render(); } });

    const shareBtn = document.createElement('button'); shareBtn.className='a-btn'; shareBtn.textContent='Ù…Ø´Ø§Ø±ÙƒØ©';
    shareBtn.addEventListener('click', (e)=>{ e.stopPropagation(); currentShareLink = item.url; openModal('shareModal'); });

    actions.append(editBtn, delBtn, shareBtn);

    // click whole tile opens link (except if clicked button)
    tile.addEventListener('click',(e)=>{ if(e.target.tagName.toLowerCase()==='button') return; window.open(item.url,'_blank'); });

    // Drag & drop handlers (reorder)
    tile.addEventListener('dragstart',(e)=>{ e.dataTransfer.setData('text/plain', item.key); tile.style.opacity='0.5'; });
    tile.addEventListener('dragend',()=>{ tile.style.opacity='1'; });
    tile.addEventListener('dragover',(e)=>{ e.preventDefault(); tile.style.outline='3px dashed rgba(255,255,255,0.04)'; });
    tile.addEventListener('dragleave',()=>{ tile.style.outline='none'; });
    tile.addEventListener('drop',(e)=>{ e.preventDefault(); tile.style.outline='none'; const fromKey = e.dataTransfer.getData('text/plain'); if(!fromKey) return; if(fromKey===item.key) return; const fromIdx = state.findIndex(s=>s.key===fromKey); const toIdx = state.findIndex(s=>s.key===item.key); const [m] = state.splice(fromIdx,1); state.splice(toIdx,0,m); saveState(); render(); });

    tile.appendChild(face);
    tile.appendChild(labelWrap);
    tile.appendChild(actions);
    grid.appendChild(tile);
  });
}
render();

const formModal = document.getElementById('formModal');
const labelInput = document.getElementById('labelInput');
const urlInput = document.getElementById('urlInput');
const faceType = document.getElementById('faceType');
const iconInput = document.getElementById('iconInput');
const imgLabel = document.getElementById('imgLabel');
const openIconPickerBtn = document.getElementById('openIconPickerBtn');
const saveModalBtn = document.getElementById('saveModal');
const cancelModalBtn = document.getElementById('cancelModal');

document.getElementById('addBtn').addEventListener('click', ()=> openFormModal(null));
cancelModalBtn.addEventListener('click', ()=> closeModal('formModal'));

faceType.addEventListener('change', ()=>{
  if(faceType.value==='icon'){ imgLabel.style.display='none'; iconInput.style.display='none'; openIconPickerBtn.style.display='block'; }
  else { imgLabel.style.display='block'; iconInput.style.display='block'; openIconPickerBtn.style.display='none'; }
});

openIconPickerBtn.addEventListener('click', ()=> openModal('iconPickerBack'));

function openFormModal(key=null){
  editingKey = null;
  if(key){
    const item = state.find(s=>s.key===key);
    if(!item) return;
    editingKey = key;
    labelInput.value = item.label;
    urlInput.value = item.url;
    faceType.value = item.faceType || 'icon';
    iconInput.value = item.icon || '';
  } else {
    labelInput.value = '';
    urlInput.value = '';
    faceType.value = 'icon';
    iconInput.value = '';
    editingKey = null;
  }
  faceType.dispatchEvent(new Event('change'));
  openModal('formModal');
}

saveModalBtn.addEventListener('click', ()=>{
  const label = labelInput.value.trim() || 'No name';
  const url = urlInput.value.trim() || '#';
  const ft = faceType.value;
  const iconVal = (ft==='icon') ? (iconInput.value || 'ğŸ”˜') : iconInput.value || '';

  if(editingKey){
    const idx = state.findIndex(s=>s.key===editingKey);
    if(idx>-1) state[idx] = { ...state[idx], label, url, faceType:ft, icon:iconVal };
  } else {
    const k = 'k'+Date.now();
    state.push({ key:k, label, url, faceType:ft, icon:iconVal });
  }
  saveState();
  render();
  closeModal('formModal');
});

const iconPickerBack = document.getElementById('iconPickerBack');
const iconGrid = document.getElementById('iconGrid');
const closeIconPicker = document.getElementById('closeIconPicker');

const ICONS = [
  'ğŸ”—','ğŸ’¬','ğŸ“','âœ‰ï¸','ğŸ“·','ğŸ¥','ğŸµ','ğŸ›’','ğŸ’¼','âš™ï¸','ğŸ“š','ğŸ§ ','ğŸ®','ğŸ’¡','ğŸ—“ï¸','ğŸ’³','ğŸ’»','ğŸ“±','ğŸ ','ğŸŒ','â­','âœ…','ğŸ””','ğŸ”','ğŸš€',
  'â¤ï¸','ğŸ“ˆ','ğŸ“Š','â˜ï¸','ğŸ','ğŸ†','ğŸ¯','ğŸ§ª','ğŸŒ','ğŸ“','ğŸ–¼ï¸','ğŸ¤','ğŸ“»','âš›ï¸',
  'ğŸ“¸','ğŸ¦','ğŸ“˜','ğŸ¬','ğŸŸ¢','ğŸ”µ','ğŸ’¼','ğŸ‘»','ğŸµ','ğŸŒ',
  'ğŸ‘¥','ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦','ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦','ğŸ¤','ğŸ“£','ğŸ‘¤','ğŸ§‘','ğŸ§‘â€ğŸ¤â€ğŸ§‘','ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§'
];

ICONS.forEach(ic=>{
  const el = document.createElement('div');
  el.className = 'icon-tile';
  el.textContent = ic;
  el.addEventListener('click', ()=>{
    iconInput.value = ic;
    closeModal('iconPickerBack');
  });
  iconGrid.appendChild(el);
});
closeIconPicker.addEventListener('click', ()=> closeModal('iconPickerBack'));

let currentShareLink = '';
const copyLinkBtn = document.getElementById('copyLinkBtn');
const whatsBtn = document.getElementById('whatsBtn');
const closeShare = document.getElementById('closeShare');

const waNoNumber = document.getElementById('waNoNumber');
const waWithNumber = document.getElementById('waWithNumber');
const waNumber = document.getElementById('waNumber');
const closeWhats = document.getElementById('closeWhats');

copyLinkBtn.addEventListener('click', ()=>{
  if(!currentShareLink) { alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©'); return; }
  navigator.clipboard.writeText(currentShareLink).then(()=> alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©') ).catch(()=> alert('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù†Ø³Ø®'));
});
whatsBtn.addEventListener('click', ()=>{
  closeModal('shareModal'); openModal('whatsModal');
});
closeShare.addEventListener('click', ()=> closeModal('shareModal'));
waNoNumber.addEventListener('click', ()=>{
  if(!currentShareLink){ alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©'); return; }
  const url = `https://wa.me/?text=${encodeURIComponent(currentShareLink)}`;
  window.open(url,'_blank');
  closeModal('whatsModal');
});
waWithNumber.addEventListener('click', ()=>{
  const num = waNumber.value.trim();
  if(!num){ alert('Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ù…Ø³ØªÙ„Ù… ØµØ­ÙŠØ­'); return; }
  if(!currentShareLink){ alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©'); return; }
  const url = `https://wa.me/${encodeURIComponent(num)}?text=${encodeURIComponent(currentShareLink)}`;
  window.open(url,'_blank');
  closeModal('whatsModal');
});
closeWhats.addEventListener('click', ()=> closeModal('whatsModal'));

const importBtn = document.getElementById('importBtn');
const exportBtn = document.getElementById('exportBtn');
const fileInput = document.getElementById('fileInput');

exportBtn.addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'menu.json';
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(a.href);
});

importBtn.addEventListener('click', ()=> fileInput.click());
fileInput.addEventListener('change', (e)=>{
  const f = e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = ()=> {
    try{
      const data = JSON.parse(r.result);
      if(Array.isArray(data)){
        state = data.map((it,idx)=> ({ key: it.key || ('k'+(Date.now()+idx)), label: it.label||'No name', url: it.url||'#', faceType: it.faceType||'icon', icon: it.icon||'ğŸ”˜' }));
        saveState(); render();
        alert('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯');
      } else alert('Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­');
    }catch{
      alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù');
    }
  };
  r.readAsText(f);
  fileInput.value='';
});

function openModal(id){ document.getElementById(id).style.display = 'flex'; }
function closeModal(id){ document.getElementById(id).style.display = 'none'; }
window.addEventListener('beforeunload', ()=> saveState() );
</script>
</body>
</html>
